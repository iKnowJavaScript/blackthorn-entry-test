<app-loader *ngIf="showLoader"></app-loader>
<div class="row" (click)="handleTopNavigation()" [ngClass]="{'d-none':currentCheckoutStep == allCheckoutStep.LIST_EVENT}">
  <div
    class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-left mt-3 ml-4 back-navigation d-flex align-items-center"
  >
    <span>&#8592;</span>
    {{
      currentCheckoutStep === allCheckoutStep.INFORMATION
        ? "Back"
        : currentEvent.name
    }}
  </div>
</div>

<div class="content">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-8 col-sm-7 col-xs-12" [ngClass]="{'col-lg-12 col-md-12 col-sm-12':currentCheckoutStep == allCheckoutStep.LIST_EVENT}">
        <app-checkout-ticket
          [currentEvent]="currentEvent"
          [currentCurrency]="currentCurrency"
          [currentCheckoutStep]="currentCheckoutStep"
          [orderSummary]="orderSummary"
          #checkoutTicket
          (handleQuantityChange)="handleQuantityChange($event)"
          (removeWishlist)="removeWishlist($event)"
          *ngIf="
            currentCheckoutStep == allCheckoutStep.SELECTION ||
            currentCheckoutStep == allCheckoutStep.VALIDATION
          "
        ></app-checkout-ticket>
        <app-checkout-form
          [currentEvent]="currentEvent"
          #checkoutForm
          [orderSummary]="orderSummary"
          (isFormValid)="handleInformationFormState($event)"
          *ngIf="currentCheckoutStep == allCheckoutStep.INFORMATION"
        ></app-checkout-form>

        <app-list-event [events]="events" (handleEventChange)="handleEventChange($event)" *ngIf="currentCheckoutStep == allCheckoutStep.LIST_EVENT"></app-list-event>
      </div>
      <div
        class="col-lg-4 col-md-4 col-sm-5 col-xs-12"
        style="position: sticky; top: 0; height: 25vh"
        [ngClass]="{'d-none':currentCheckoutStep == allCheckoutStep.LIST_EVENT}"
      >
        <div class="widget">
          <h4 class="widget-title">Order Summary</h4>
          <div class="summary-block">
            <ng-container
              *ngIf="currentCheckoutStep === allCheckoutStep.SELECTION"
            >
              <ng-container *ngFor="let item of orderSummary">
                <div class="summary-content">
                  <div class="summary-head d-inline-block">
                    <span class="summary-title"
                      >{{ item.requestQuantity }}x {{ item.title }}</span
                    >
                  </div>
                  <div class="summary-price">
                    <span class="summary-small-text">{{
                      item.price * item.requestQuantity
                        | currency: currentCurrency
                    }}</span>
                  </div>
                </div>
              </ng-container>
            </ng-container>

            <ng-container
              *ngIf="currentCheckoutStep !== allCheckoutStep.SELECTION"
            >
              <ng-container *ngFor="let item of orderSummary">
                <div class="summary-content">
                  <div class="summary-head d-inline-block">
                    <span class="summary-title"
                      >{{ item.availableQuantity }}x {{ item.title }}</span
                    >
                  </div>
                  <div class="summary-price">
                    <span class="summary-small-text">{{
                      item.price * item.availableQuantity
                        | currency: currentCurrency
                    }}</span>
                  </div>
                </div>
              </ng-container>
            </ng-container>

            <ng-container
              *ngIf="currentCheckoutStep !== allCheckoutStep.SELECTION"
            >
              <ng-container *ngFor="let item of orderSummary">
                <div class="summary-content" *ngIf="item.isWaitList">
                  <div class="summary-head d-inline-block">
                    <span class="summary-title mute-text"
                      >{{ item.waitlistQuantity }}x {{ item.title }}</span
                    >
                  </div>
                  <div class="summary-price">
                    <span class="summary-small-text mute-text">{{
                      item.price * item.waitlistQuantity
                        | currency: currentCurrency
                    }}</span>
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </div>
          <div class="summary-block">
            <div class="summary-content pb-0">
              <div class="summary-head d-inline-block">
                <h6 class="summary-title">Subtotal</h6>
              </div>
              <div class="summary-price">
                <span class="summary-small-text">{{
                  getOrderTotal() | currency: currentCurrency
                }}</span>
              </div>
            </div>
            <div class="summary-content pb-0">
              <div class="summary-head d-inline-block">
                <h6 class="summary-title">Taxes</h6>
              </div>
              <div class="summary-price">
                <span class="summary-small-text">{{
                  getOrderTax() | currency: currentCurrency
                }}</span>
              </div>
            </div>
          </div>
          <div class="summary-block">
            <div class="summary-content">
              <div class="summary-head d-inline-block">
                <h5 class="summary-title">Total</h5>
              </div>
              <div class="summary-price">
                <h5 class="summary-small-text">
                  {{ getGrandTotal() | currency: currentCurrency }}
                </h5>
              </div>
            </div>
          </div>
          <a href="#" class="d-inline-flex my-4">Have a promo code?</a>
          <div
            class="input-group"
            *ngIf="currentCheckoutStep === allCheckoutStep.VALIDATION"
          >
            <input type="text" class="form-control" placeholder="Promo code" />
            <button type="submit" class="btn custom-secondary ml-2">
              Redeem
            </button>
          </div>
        </div>
        <button
          *ngIf="currentCheckoutStep !== allCheckoutStep.INFORMATION"
          class="custom-btn btn-primary btn-lg mb30 w-100"
          (click)="gotoNextStep()"
        >
          Checkout
        </button>
        <button
          *ngIf="currentCheckoutStep === allCheckoutStep.INFORMATION"
          class="custom-btn btn-primary btn-lg mb30 w-100"
          (click)="validateForm()"
          [disabled]="!isTicketFormvalid"
        >
          Review Sessions
        </button>
      </div>
    </div>
  </div>
</div>
